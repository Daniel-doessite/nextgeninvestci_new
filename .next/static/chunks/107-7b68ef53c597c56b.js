"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{20514:(e,t,r)=>{r.d(t,{O:()=>v,A:()=>m});var i=r(95155),a=r(12115),s=r(87481),n=r(10851),o=r(49509);let u=o.env.NEXT_PUBLIC_SUPABASE_URL||"https://rbasuowvzdxddqlwpejp.supabase.co",d=o.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJiYXN1b3d2emR4ZGRxbHdwZWpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDExODUzMDksImV4cCI6MjA1Njc2MTMwOX0.dtreaLZP_d_NpSLn9eNJIvbsRMf0g8dzlnhdZLZrp9Q",c=(0,n.UU)(u,d);var l=r(35695);let p=(0,a.createContext)(void 0),v=e=>{let{children:t}=e,[r,n]=(0,a.useState)(null),[o,u]=(0,a.useState)(!0),[d,v]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[f,w]=(0,a.useState)([]),S=(0,l.useRouter)();(0,l.usePathname)(),(0,a.useEffect)(()=>{let e=async()=>{try{let{data:{session:e}}=await c.auth.getSession();e&&await y(e.user)}catch(e){}finally{u(!1)}},{data:{subscription:t}}=c.auth.onAuthStateChange(async(e,t)=>{t&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)?await y(t.user):"SIGNED_OUT"===e&&(n(null),v(!1),h(!1))});return e(),()=>{t.unsubscribe()}},[]);let y=async e=>{try{let{data:t,error:r}=await c.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;if(t){let e="admin"===t.role&&t.is_approved;v(e),e&&!m&&h(e),n(t),e&&await E()}}catch(e){}},E=async()=>{try{let{data:e,error:t}=await c.from("profiles").select("*").eq("role","admin").eq("is_approved",!1);if(t)throw t;e&&w(e)}catch(e){}},I=async()=>{if(!r||!d)return(0,s.oR)({variant:"destructive",title:"Acc\xe8s refus\xe9",description:"Vous devez \xeatre administrateur pour g\xe9n\xe9rer une invitation."}),"";try{let e=Math.random().toString(36).substring(2,15),t="".concat(window.location.origin,"/register-admin?code=").concat(e,"&invited_by=").concat(r.id);return(0,s.oR)({title:"Invitation g\xe9n\xe9r\xe9e",description:"L'URL d'invitation a \xe9t\xe9 g\xe9n\xe9r\xe9e avec succ\xe8s."}),t}catch(e){return(0,s.oR)({variant:"destructive",title:"Erreur",description:"Une erreur est survenue lors de la g\xe9n\xe9ration de l'invitation."}),""}},_=async()=>d?f:[],g=async e=>{if(!r||!d)return void(0,s.oR)({variant:"destructive",title:"Acc\xe8s refus\xe9",description:"Vous devez \xeatre administrateur pour approuver une invitation."});try{let t={role:"admin",is_approved:!0,updated_at:new Date().toISOString()},{error:r}=await c.from("profiles").update(t).eq("id",e);if(r)throw r;w(f.filter(t=>t.id!==e)),(0,s.oR)({title:"Invitation approuv\xe9e",description:"L'utilisateur a \xe9t\xe9 promu administrateur avec succ\xe8s."})}catch(e){(0,s.oR)({variant:"destructive",title:"Erreur",description:"Une erreur est survenue lors de l'approbation de l'invitation."})}},R=async e=>{if(!r||!d)return void(0,s.oR)({variant:"destructive",title:"Acc\xe8s refus\xe9",description:"Vous devez \xeatre administrateur pour rejeter une invitation."});try{let t={role:"user",invited_by:null,updated_at:new Date().toISOString()},{error:r}=await c.from("profiles").update(t).eq("id",e);if(r)throw r;w(f.filter(t=>t.id!==e)),(0,s.oR)({title:"Invitation rejet\xe9e",description:"L'invitation a \xe9t\xe9 rejet\xe9e avec succ\xe8s."})}catch(e){(0,s.oR)({variant:"destructive",title:"Erreur",description:"Une erreur est survenue lors du rejet de l'invitation."})}},A=async(e,t)=>{try{let i=e.includes("@"),{data:a,error:n}=await c.auth.signInWithPassword({email:i?e:"".concat(e,"@example.com"),password:t});if(n)throw n;if(a.user){var r;await y(a.user);let e=(null==(r=a.user.user_metadata)?void 0:r.role)==="admin";(0,s.oR)({title:"Connexion r\xe9ussie",description:"Vous \xeates maintenant connect\xe9".concat(e?" en tant qu'administrateur":"",".")}),S.push("/")}}catch(e){(0,s.oR)({variant:"destructive",title:"Erreur de connexion",description:e.message||"Une erreur s'est produite lors de la connexion."})}},T=async function(e,t,r,i){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";try{let{data:o,error:u}=await c.auth.signUp({email:e,password:r,options:{data:{username:t,birthdate:i,role:a?"admin":"user"}}});if(u)throw u;if(o.user){let r=new Date().toISOString(),u={id:o.user.id,email:e,username:t,birthdate:i,role:a?"admin":"user",is_approved:!a,invited_by:n||null,is_premium:!1,updated_at:r,gender:null,avatar_url:null},{error:d}=await c.from("profiles").insert(u);if(d)throw d;(0,s.oR)({title:"Inscription r\xe9ussie",description:"Votre compte a \xe9t\xe9 cr\xe9\xe9 avec succ\xe8s. Veuillez v\xe9rifier votre email pour confirmer votre inscription."}),S.push("/login")}}catch(e){(0,s.oR)({variant:"destructive",title:"Erreur d'inscription",description:e.message||"Une erreur s'est produite lors de l'inscription."})}},U=async()=>{try{let{error:e}=await c.auth.signOut();if(e)throw e;n(null),v(!1),h(!1),(0,s.oR)({title:"D\xe9connexion r\xe9ussie",description:"Vous avez \xe9t\xe9 d\xe9connect\xe9 avec succ\xe8s."}),S.push("/")}catch(e){(0,s.oR)({variant:"destructive",title:"Erreur de d\xe9connexion",description:e.message||"Une erreur s'est produite lors de la d\xe9connexion."})}},O=async e=>{try{if(!r)throw Error("Vous devez \xeatre connect\xe9 pour modifier votre profil");if(e.email&&e.email!==r.email){let{error:t}=await c.auth.updateUser({email:e.email});if(t)throw t}let t={username:e.username||r.username,birthdate:e.birthdate||r.birthdate,gender:e.gender||r.gender,updated_at:new Date().toISOString()},{error:i}=await c.from("profiles").update(t).eq("id",r.id);if(i)throw i;return n(t=>t?{...t,...e}:null),(0,s.oR)({title:"Profil mis \xe0 jour",description:"Vos informations ont \xe9t\xe9 mises \xe0 jour avec succ\xe8s."}),S.push("/"),Promise.resolve()}catch(e){return(0,s.oR)({variant:"destructive",title:"Erreur de mise \xe0 jour",description:e.message||"Une erreur s'est produite lors de la mise \xe0 jour du profil."}),Promise.reject(e)}},P=async e=>{try{return await new Promise(e=>setTimeout(e,1500)),(0,s.oR)({title:"Email envoy\xe9",description:"Un email de v\xe9rification a \xe9t\xe9 envoy\xe9 \xe0 ".concat(e)}),Promise.resolve()}catch(e){return(0,s.oR)({variant:"destructive",title:"Erreur d'envoi",description:e.message||"Une erreur s'est produite lors de l'envoi de l'email."}),Promise.reject(e)}},b=async e=>{try{let{error:t}=await c.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/reset-password")});if(t)throw t;return(0,s.oR)({title:"Email envoy\xe9",description:"Un email de r\xe9initialisation a \xe9t\xe9 envoy\xe9."}),Promise.resolve()}catch(e){return(0,s.oR)({variant:"destructive",title:"Erreur d'envoi",description:e.message||"Une erreur s'est produite lors de l'envoi de l'email."}),Promise.reject(e)}},D=async e=>{try{let{error:t}=await c.auth.updateUser({password:e});if(t)throw t;return(0,s.oR)({title:"Mot de passe mis \xe0 jour",description:"Votre mot de passe a \xe9t\xe9 r\xe9initialis\xe9 avec succ\xe8s."}),Promise.resolve()}catch(e){return(0,s.oR)({variant:"destructive",title:"Erreur de r\xe9initialisation",description:e.message||"Une erreur s'est produite lors de la r\xe9initialisation du mot de passe."}),Promise.reject(e)}};return(0,i.jsx)(p.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:o,isAdmin:d,isViewingAsAdmin:m,login:A,register:T,logout:U,updateProfile:O,sendVerificationEmail:P,sendResetPasswordEmail:b,resetPassword:D,toggleAdminView:()=>{d&&(h(!m),S.push(m?"/":"/admin"),(0,s.oR)({title:"Mode ".concat(m?"utilisateur":"administrateur"," activ\xe9"),description:"Vous naviguez maintenant en tant qu'".concat(m?"utilisateur":"administrateur",".")}))},generateAdminInviteLink:I,getPendingAdminInvites:_,approveAdminInvite:g,rejectAdminInvite:R},children:t})};function m(){let e=(0,a.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},59434:(e,t,r)=>{r.d(t,{cn:()=>s});var i=r(52596),a=r(39688);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,i.$)(t))}},87481:(e,t,r)=>{r.d(t,{dj:()=>p,oR:()=>l});var i=r(12115);let a=0,s=new Map,n=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},u=[],d={toasts:[]};function c(e){d=o(d,e),u.forEach(e=>{e(d)})}function l(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||i()}}}),{id:r,dismiss:i,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function p(){let[e,t]=i.useState(d);return i.useEffect(()=>(u.push(t),()=>{let e=u.indexOf(t);e>-1&&u.splice(e,1)}),[e]),{...e,toast:l,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}}]);